<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCL-90心理健康自评量表</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #3498db, #2c3e50);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content {
            padding: 30px;
        }
        
        .instructions {
            background-color: #e1f5fe;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #03a9f4;
            font-size: 16px;
        }
        
        .instructions h3 {
            color: #0288d1;
            margin-bottom: 10px;
        }
        
        .link-generator {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 5px solid #4caf50;
        }
        
        .copy-link-container {
            display: flex;
            margin-top: 10px;
        }
        
        #test-link {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
            font-size: 14px;
        }
        
        #copy-link-btn {
            padding: 10px 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        #copy-link-btn:hover {
            background: #3d8b40;
        }
        
        .question-container {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #fff;
        }
        
        .question {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 20px;
            color: #2c3e50;
            padding-bottom: 10px;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .options {
                grid-template-columns: 1fr;
            }
        }
        
        .option-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }
        
        .option-label:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .option-label.selected {
            background: #4CAF50;
            color: white;
            border-color: #3d8b40;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        input[type="radio"] {
            display: none;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        button {
            padding: 14px 30px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-container {
            margin: 25px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .progress-bar {
            height: 12px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
            color: #7f8c8d;
        }
        
        .results {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #2c3e50;
        }
        
        .results h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .score-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .score-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .score-card h3 {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .score-value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .factor {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        
        .factor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .factor-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .factor-score {
            font-weight: bold;
            font-size: 18px;
        }
        
        .factor-description {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }
        
        .factor-suggestion {
            margin-top: 10px;
            padding: 10px;
            background: #fff8e1;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .interpretation {
            margin-top: 30px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 8px;
            border-left: 5px solid #4CAF50;
        }
        
        .interpretation h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .recommendation {
            margin-top: 20px;
            padding: 20px;
            background: #ffecb3;
            border-radius: 8px;
            border-left: 5px solid #ffa000;
        }
        
        .recommendation h3 {
            color: #ff6f00;
            margin-bottom: 15px;
        }
        
        .note {
            margin-top: 20px;
            font-style: italic;
            color: #e91e63;
            text-align: center;
            font-size: 14px;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .test-completed {
            text-align: center;
            padding: 40px;
        }
        
        .test-completed i {
            font-size: 60px;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        .test-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        
        .hidden {
            display: none;
        }
        
        .test-section {
            transition: all 0.3s ease;
        }
        
        .suggestion-box {
            margin-top: 15px;
            padding: 12px;
            background: #e3f2fd;
            border-radius: 6px;
            border-left: 4px solid #2196f3;
        }
        
        .suggestion-title {
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 5px;
        }

        .completion-alert {
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-brain"></i> SCL-90心理健康自评量表</h1>
            <p class="description">以下列出了有些人可能会有的问题，请仔细阅读每一条，然后根据最近一星期以内您的实际感觉，选择最符合您的一种情况。</p>
        </header>
        
        <div class="content">
            <!-- 测试已完成提示 -->
            <div class="test-completed hidden" id="test-completed">
                <i class="fas fa-check-circle"></i>
                <h2>您已完成测试</h2>
                <p>此测试已经完成，以下是您的测试结果。</p>
                <div class="test-info">
                    <p><i class="fas fa-calendar"></i> 完成时间: <span id="completion-time">未知</span></p>
                </div>
            </div>
            
            <!-- 测试界面 -->
            <div class="test-section" id="test-section">
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 评分说明</h3>
                    <p>1=从无，2=很轻，3=中等，4=偏重，5=严重</p>
                    <p>请根据最近一星期内您的实际感受进行选择，不要花费太多时间思考，凭第一感觉回答即可。</p>
                    
                    <div class="link-generator">
                        <h3><i class="fas fa-link"></i> 专属测试链接</h3>
                        <p>请复制以下专属链接进行测试（每个链接只能使用一次）：</p>
                        <div class="copy-link-container">
                            <input type="text" id="test-link" readonly>
                            <button id="copy-link-btn"><i class="fas fa-copy"></i> 复制链接</button>
                        </div>
                    </div>
                    
                    <div class="completion-alert">
                        <p><i class="fas fa-exclamation-circle"></i> 请注意：每个测试链接只能提交一次</p>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-text">
                        <span>测试进度: <span id="progress">0</span>%</span>
                        <span>题目 <span id="current">1</span>/90</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" id="progress-bar"></div>
                    </div>
                </div>
                
                <div class="question-container">
                    <div class="question" id="question-text">1. 头痛</div>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="answer" value="1">
                            <span>从无 (1)</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="answer" value="2">
                            <span>很轻 (2)</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="answer" value="3">
                            <span>中等 (3)</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="answer" value="4">
                            <span>偏重 (4)</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="answer" value="5">
                            <span>严重 (5)</span>
                        </label>
                    </div>
                </div>
                
                <div class="navigation">
                    <button id="prev-btn" disabled><i class="fas fa-arrow-left"></i> 上一题</button>
                    <button id="next-btn">下一题 <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <!-- 结果展示区域 -->
            <div class="results hidden" id="results">
                <h2><i class="fas fa-chart-line"></i> 测试结果分析</h2>
                
                <div class="score-summary">
                    <div class="score-card">
                        <h3>总分</h3>
                        <div class="score-value" id="total-score">0</div>
                    </div>
                    <div class="score-card">
                        <h3>阳性项目数</h3>
                        <div class="score-value" id="positive-items">0</div>
                    </div>
                    <div class="score-card">
                        <h3>阳性症状均分</h3>
                        <div class="score-value" id="average-score">0.00</div>
                    </div>
                </div>
                
                <h3>各因子分分析</h3>
                <div id="factors-analysis">
                    <!-- 因子分析将通过JS动态生成 -->
                </div>
                
                <div class="interpretation">
                    <h3><i class="fas fa-comment-dots"></i> 结果解读</h3>
                    <p id="interpretation-text">根据您的测试结果，您当前的心理健康状况总体良好。SCL-90量表的总分和因子分都在正常范围内，表明您近期没有明显的心理症状表现。</p>
                </div>
                
                <div class="recommendation">
                    <h3><i class="fas fa-hands-helping"></i> 建议</h3>
                    <p id="recommendation-text">继续保持健康的生活方式和积极的心态。定期进行自我心理状态评估有助于维持心理健康。如有需要，可以尝试放松训练或正念冥想。</p>
                </div>
                
                <div class="note">
                    <p>注意：本测试结果仅供参考，不能作为临床诊断依据。如有严重心理困扰，请咨询专业心理医生或心理咨询师。</p>
                </div>
            </div>
            
            <div class="footer">
                <p>© 2024~2026 心理健康评估系统 | 本测试基于SCL-90症状自评量表</p>
            </div>
        </div>
    </div>

    <script>
        // SCL-90完整测试题目（共90题）
        const questions = [
            "1. 头痛",
            "2. 神经过敏，心中不踏实",
            "3. 头脑中有不必要的想法或字句盘旋",
            "4. 头昏或昏倒",
            "5. 对异性的兴趣减退",
            "6. 对旁人责备求全",
            "7. 感到别人能控制您的思想",
            "8. 责怪别人制造麻烦",
            "9. 忘记性大",
            "10. 担心自己的衣饰整齐及仪态的端正",
            "11. 容易烦恼和激动",
            "12. 胸痛",
            "13. 害怕空旷的场所或街道",
            "14. 感到自己的精力下降，活动减慢",
            "15. 想结束自己的生命",
            "16. 听到旁人听不到的声音",
            "17. 发抖",
            "18. 感到大多数人都不可信任",
            "19. 胃口不好",
            "20. 容易哭泣",
            "21. 同异性相处时感到害羞不自在",
            "22. 感到受骗，中了圈套或有人想抓住您",
            "23. 无缘无故地突然感到害怕",
            "24. 自己不能控制地大发脾气",
            "25. 怕单独出门",
            "26. 经常责怪自己",
            "27. 腰痛",
            "28. 感到难以完成任务",
            "29. 感到孤独",
            "30. 感到苦闷",
            "31. 过分担忧",
            "32. 对事物不感兴趣",
            "33. 感到害怕",
            "34. 您的感情容易受到伤害",
            "35. 旁人能知道您的私下想法",
            "36. 感到别人不理解您、不同情您",
            "37. 感到人们对您不友好，不喜欢您",
            "38. 做事必须做得很慢以保证做得正确",
            "39. 心跳得很厉害",
            "40. 恶心或胃部不舒服",
            "41. 感到比不上他人",
            "42. 肌肉酸痛",
            "43. 感到有人在监视您、谈论您",
            "44. 难以入睡",
            "45. 做事必须反复检查",
            "46. 难以作出决定",
            "47. 怕乘电车、公共汽车、地铁或火车",
            "48. 呼吸有困难",
            "49. 一阵阵发冷或发热",
            "50. 因为感到害怕而避开某些东西、场合或活动",
            "51. 脑子变空了",
            "52. 身体发麻或刺痛",
            "53. 喉咙有梗塞感",
            "54. 感到前途没有希望",
            "55. 不能集中注意",
            "56. 感到身体的某一部分软弱无力",
            "57. 感到紧张或容易紧张",
            "58. 感到手或脚发重",
            "59. 想到死亡的事",
            "60. 吃得太多",
            "61. 当别人看着您或谈论您时感到不自在",
            "62. 有一些不属于您自己的想法",
            "63. 有想打人或伤害他人的冲动",
            "64. 醒得太早",
            "65. 必须反复洗手、点数目或触摸某些东西",
            "66. 睡得不稳不深",
            "67. 有想摔坏或破坏东西的冲动",
            "68. 有一些别人没有的想法或念头",
            "69. 感到对别人神经过敏",
            "70. 在商店或电影院等人多的地方感到不自在",
            "71. 感到做任何事情都很困难",
            "72. 一阵阵恐惧或惊恐",
            "73. 感到在公共场合吃东西很不舒服",
            "74. 经常与人争论",
            "75. 单独一人时神经很紧张",
            "76. 别人对您的成绩没有作出恰当的评价",
            "77. 即使和别人在一起也感到孤单",
            "78. 感到坐立不安心神不定",
            "79. 感到自己没有什么价值",
            "80. 感到熟悉的东西变成陌生或不像是真的",
            "81. 大叫或摔东西",
            "82. 害怕会在公共场合昏倒",
            "83. 感到别人想占您的便宜",
            "84. 为一些有关'性'的想法而很苦恼",
            "85. 您认为应该因为自己的过错而受到惩罚",
            "86. 感到要赶快把事情做完",
            "87. 感到自己的身体有严重问题",
            "88. 从未感到和其他人很亲近",
            "89. 感到自己有罪",
            "90. 感到自己的脑子有毛病"
        ];
        
        // SCL-90因子定义（标准SCL-90因子结构）
        const factors = [
            {
                name: "躯体化",
                indices: [0, 3, 11, 26, 38, 47, 50, 51, 55, 56],
                score: 0,
                description: "反映主观的身体不适感，包括心血管、胃肠道、呼吸系统的主诉不适，头痛、背痛、肌肉酸痛等其他躯体表现。",
                suggestions: {
                    low: "您的身体不适感在正常范围内，没有明显的躯体症状。继续保持健康的生活方式，定期锻炼和保持充足睡眠。",
                    mild: "您可能偶尔感到身体不适，建议关注身体健康，适当进行放松和休息。可以考虑练习瑜伽或冥想缓解身体紧张。",
                    moderate: "您有明显的身体不适症状，建议进行身体检查排除器质性问题，并学习压力管理技巧。定期进行放松训练有助于缓解症状。",
                    severe: "您的躯体症状较为明显，可能影响日常生活，建议寻求医疗帮助并进行全面的身体检查。同时考虑心理咨询处理潜在的心理因素。"
                }
            },
            {
                name: "强迫症状",
                indices: [2, 8, 27, 37, 44, 54, 64, 79],
                score: 0,
                description: "主要指那些明知没有必要，但又无法摆脱的无意义的思想、冲动和行为。",
                suggestions: {
                    low: "您的强迫症状在正常范围内，思维和行为模式较为健康。继续保持这种平衡状态。",
                    mild: "您可能有轻微的强迫倾向，建议学习放松技巧，避免过度追求完美。尝试设定合理的时间限制完成任务。",
                    moderate: "您有明显的强迫症状，可能影响效率，建议学习认知行为技巧，减少不必要的重复行为。可以尝试正念练习来减少强迫思维。",
                    severe: "您的强迫症状较为严重，可能显著影响日常生活，建议寻求专业心理咨询或治疗。认知行为疗法对强迫症状有良好效果。"
                }
            },
            {
                name: "人际关系敏感",
                indices: [5, 20, 33, 35, 36, 60, 68, 69, 72],
                score: 0,
                description: "指某些个人不自在与自卑感，特别是在与其他人相比较时更加突出。",
                suggestions: {
                    low: "您的人际关系敏感度在正常范围内，社交能力良好。继续保持积极的社交互动。",
                    mild: "您可能对他人评价较为敏感，建议增强自信，学习积极的社交技巧。尝试参加社交活动逐步建立信心。",
                    moderate: "您对人际关系较为敏感，可能影响社交功能，建议参加社交技能训练或寻求支持。可以练习自我肯定和积极自我对话。",
                    severe: "您的人际关系敏感度较高，可能伴有社交回避，建议寻求专业帮助改善社交能力和自我认知。团体治疗可能特别有帮助。"
                }
            },
            {
                name: "抑郁",
                indices: [4, 13, 14, 19, 25, 28, 29, 30, 31, 52, 53, 70, 78, 87],
                score: 0,
                description: "反映与临床抑郁症状相联系的广泛概念，包括对生活的兴趣减退、缺乏动力、失望、悲观等。",
                suggestions: {
                    low: "您的情绪状态在正常范围内，没有明显的抑郁症状。继续保持积极的生活态度和健康习惯。",
                    mild: "您可能有轻微的情绪低落，建议增加愉悦活动，保持社交联系，关注情绪变化。规律的体育锻炼有助于提升情绪。",
                    moderate: "您有明显的抑郁症状，建议寻求专业评估，增加体育锻炼和社会支持，学习情绪调节技巧。考虑记录情绪日记来识别触发因素。",
                    severe: "您的抑郁症状较为严重，可能显著影响日常生活，建议尽快寻求专业心理帮助和评估。心理咨询和必要时的药物治疗可以显著改善症状。"
                }
            },
            {
                name: "焦虑",
                indices: [1, 10, 16, 22, 32, 39, 57, 71, 77, 81, 85],
                score: 0,
                description: "包括一些通常在临床上明显与焦虑症状相联系的症状与体验，如紧张、神经过敏、颤抖等。",
                suggestions: {
                    low: "您的焦虑症状在正常范围内，情绪较为平稳。继续保持有效的压力管理策略。",
                    mild: "您可能有轻度的焦虑感受，建议学习放松技巧和正念冥想，保持规律作息。深呼吸练习可以在焦虑时提供即时缓解。",
                    moderate: "您有明显的焦虑症状，可能影响日常生活，建议学习焦虑管理技巧，必要时寻求专业帮助。渐进式肌肉放松法可能对您有帮助。",
                    severe: "您的焦虑症状较为严重，可能伴有躯体症状，建议尽快寻求专业评估和治疗，学习应对策略。认知行为疗法对焦虑症有良好效果。"
                }
            },
            {
                name: "敌对",
                indices: [7, 23, 62, 73, 79, 83],
                score: 0,
                description: "主要从思维、情感及行为三个方面来反映受试者的敌对表现。",
                suggestions: {
                    low: "您的敌对情绪在正常范围内，情绪表达较为健康。继续保持有效的沟通方式。",
                    mild: "您可能有轻度的敌对情绪，建议学习情绪管理和沟通技巧，寻找健康的情绪表达方式。尝试在冲突时暂停片刻再回应。",
                    moderate: "您有明显的敌对情绪，可能影响人际关系，建议学习愤怒管理技巧，寻求冲突解决方法。非暴力沟通技巧可能对您有帮助。",
                    severe: "您的敌对情绪较为严重，可能伴有冲动行为，建议寻求专业帮助学习情绪调节和冲突管理。愤怒管理课程可能特别有益。"
                }
            },
            {
                name: "恐怖",
                indices: [12, 24, 46, 49, 58, 75, 82],
                score: 0,
                description: "与传统的恐怖状态所反映的内容基本一致，包括对出门旅行、空旷场地、人群、公共场所和交通工具的恐怖。",
                suggestions: {
                    low: "您的恐怖症状在正常范围内，没有明显的恐惧反应。继续保持这种适应性反应模式。",
                    mild: "您可能对某些情境有轻微恐惧，建议逐步暴露于恐惧情境以减少焦虑。可以尝试系统脱敏练习。",
                    moderate: "您有明显的恐怖症状，可能影响日常生活，建议学习应对技巧或寻求专业帮助进行系统脱敏。放松技巧可以帮助您在恐惧情境中保持冷静。",
                    severe: "您的恐怖症状较为严重，可能导致回避行为，建议寻求专业治疗如暴露疗法和认知行为治疗。专业指导下的暴露治疗是最有效的方法。"
                }
            },
            {
                name: "偏执",
                indices: [6, 17, 21, 42, 65, 76, 84],
                score: 0,
                description: "包括猜疑、关系观念、妄想、被动体验和夸大等。",
                suggestions: {
                    low: "您的偏执观念在正常范围内，思维较为理性。继续保持客观的思考方式。",
                    mild: "您可能有轻度的猜疑倾向，建议增强对他人的信任和开放度，学习现实检验技巧。尝试从多个角度看待 situations。",
                    moderate: "您有明显的偏执观念，可能影响人际关系，建议学习现实检验技巧，寻求客观反馈。信任建立练习可能对您有帮助。",
                    severe: "您的偏执观念较为严重，可能伴有关系妄想，建议寻求专业心理评估和支持。认知疗法可以帮助挑战和改变不合理的信念。"
                }
            },
            {
                name: "精神病性",
                indices: [15, 34, 40, 59, 61, 63, 66, 67, 74, 80, 86, 88, 89],
                score: 0,
                description: "包括一些精神分裂症症状项目，如幻听、思维播散、被控制感等。",
                suggestions: {
                    low: "您的精神病性症状在正常范围内，思维清晰。继续保持良好的现实检验能力。",
                    mild: "您可能有轻微的非典型思维体验，建议关注压力管理和心理健康，保持现实检验能力。确保充足的睡眠有助于保持思维清晰。",
                    moderate: "您有明显的精神病性症状，建议寻求专业评估以排除严重问题，学习现实检验技巧。减少压力和环境刺激可能有助于症状缓解。",
                    severe: "您的精神病性症状较为严重，建议尽快寻求精神科专业评估和治疗，确保得到适当支持。早期干预对预后有重要影响。"
                }
            },
            {
                name: "其他",
                indices: [18, 43, 45, 48, 60, 64, 86],
                score: 0,
                description: "反映睡眠和饮食情况以及其他附加项目。",
                suggestions: {
                    low: "您的睡眠和饮食情况在正常范围内。继续保持健康的生活习惯。",
                    mild: "您可能有轻微的睡眠或饮食问题，建议建立规律的生活作息，关注健康习惯。避免咖啡因和屏幕时间睡前可能改善睡眠。",
                    moderate: "您有明显的睡眠或饮食问题，可能影响健康，建议寻求专业建议，改善生活习惯。睡眠卫生教育和饮食日记可能有助于识别问题。",
                    severe: "您的睡眠或饮食问题较为严重，建议尽快就医或寻求专业帮助，确保身体健康。睡眠专科或营养师可以提供专业指导。"
                }
            }
        ];
        
        // 初始化90个题目的答案数组
        const answers = new Array(questions.length).fill(0);
        
        // 初始化变量
        let currentQuestion = 0;
        let testId = null;
        
        // DOM元素
        const testSection = document.getElementById('test-section');
        const testCompleted = document.getElementById('test-completed');
        const resultsDiv = document.getElementById('results');
        const questionText = document.getElementById('question-text');
        const progressText = document.getElementById('progress');
        const currentText = document.getElementById('current');
        const progressBar = document.getElementById('progress-bar');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const totalScoreEl = document.getElementById('total-score');
        const positiveItemsEl = document.getElementById('positive-items');
        const averageScoreEl = document.getElementById('average-score');
        const factorsAnalysisEl = document.getElementById('factors-analysis');
        const interpretationText = document.getElementById('interpretation-text');
        const recommendationText = document.getElementById('recommendation-text');
        const completionTimeElement = document.getElementById('completion-time');
        const testLinkInput = document.getElementById('test-link');
        const copyLinkBtn = document.getElementById('copy-link-btn');
        const optionLabels = document.querySelectorAll('.option-label');
        
        // 生成UUID函数
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        // 初始化唯一链接
        function initUniqueLink() {
            // 检查URL中是否已有测试ID
            const urlParams = new URLSearchParams(window.location.search);
            testId = urlParams.get('id');
            
            // 如果没有ID，生成一个新的
            if (!testId) {
                testId = generateUUID();
                const newUrl = `${window.location.origin}${window.location.pathname}?id=${testId}`;
                
                // 显示链接供复制
                testLinkInput.value = newUrl;
                
                // 在本地存储中标记此链接为未使用
                const usedLinks = JSON.parse(localStorage.getItem('scl90_used_links') || '{}');
                if (!usedLinks[testId]) {
                    usedLinks[testId] = { used: false, generatedAt: new Date().toISOString() };
                    localStorage.setItem('scl90_used_links', JSON.stringify(usedLinks));
                }
            } else {
                // 如果URL中有ID，隐藏链接生成器
                document.querySelector('.link-generator').style.display = 'none';
            }
            
            // 检查测试是否已完成
            const completedTest = checkTestCompleted(testId);
            if (completedTest) {
                // 如果测试已完成，显示结果
                testSection.classList.add('hidden');
                testCompleted.classList.remove('hidden');
                resultsDiv.classList.remove('hidden');
                
                completionTimeElement.textContent = new Date(completedTest.timestamp).toLocaleString();
                
                // 显示之前的结果
                displayResults(completedTest.results);
            }
        }
        
        // 复制链接功能
        copyLinkBtn.addEventListener('click', function() {
            testLinkInput.select();
            document.execCommand('copy');
            
            // 显示复制成功反馈
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check"></i> 已复制';
            this.style.background = '#2e7d32';
            setTimeout(() => {
                this.innerHTML = originalText;
                this.style.background = '';
            }, 2000);
        });
        
        // 检查是否已完成测试
        function checkTestCompleted(testId) {
            const usedLinks = JSON.parse(localStorage.getItem('scl90_used_links') || '{}');
            return usedLinks[testId] && usedLinks[testId].used ? usedLinks[testId] : false;
        }
        
        // 标记测试为已完成
        function markTestCompleted(testId, results) {
            const usedLinks = JSON.parse(localStorage.getItem('scl90_used_links') || '{}');
            usedLinks[testId] = {
                used: true,
                completedAt: new Date().toISOString(),
                results: results,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('scl90_used_links', JSON.stringify(usedLinks));
        }
        
        // 页面初始化
        function initPage() {
            initUniqueLink();
            
            // 如果测试未完成，显示测试界面
            if (!checkTestCompleted(testId)) {
                testSection.classList.remove('hidden');
                testCompleted.classList.add('hidden');
                resultsDiv.classList.add('hidden');
                
                showQuestion();
            }
        }
        
        // 更新进度
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            progressText.textContent = progress.toFixed(0);
            progressBar.style.width = `${progress}%`;
            currentText.textContent = currentQuestion + 1;
        }
        
        // 显示当前题目
        function showQuestion() {
            questionText.textContent = questions[currentQuestion];
            
            // 清除之前的选择
            document.querySelectorAll('input[name="answer"]').forEach(input => {
                input.checked = false;
            });
            
            // 清除选项的选中样式
            optionLabels.forEach(label => {
                label.classList.remove('selected');
            });
            
            // 如果之前已回答过，恢复选择
            if (answers[currentQuestion] !== 0) {
                const selectedInput = document.querySelector(`input[name="answer"][value="${answers[currentQuestion]}"]`);
                if (selectedInput) {
                    selectedInput.checked = true;
                    selectedInput.parentElement.classList.add('selected');
                }
            }
            
            // 更新按钮状态
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === questions.length - 1 ? '完成测试' : '下一题';
            
            updateProgress();
        }
        
        // 选择答案
        optionLabels.forEach(label => {
            label.addEventListener('click', () => {
                const input = label.querySelector('input');
                input.checked = true;
                answers[currentQuestion] = parseInt(input.value);
                
                // 更新UI
                optionLabels.forEach(l => l.classList.remove('selected'));
                label.classList.add('selected');
            });
        });
        
        // 上一题
        prevBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        });
        
        // 下一题/完成
        nextBtn.addEventListener('click', () => {
            if (answers[currentQuestion] === 0) {
                alert('请选择答案后再继续');
                return;
            }
            
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                // 完成测试，显示结果
                showResults();
            }
        });
        
        // 计算因子分
        function calculateFactorScores() {
            factors.forEach(factor => {
                let sum = 0;
                let count = 0;
                
                factor.indices.forEach(index => {
                    if (answers[index] > 0) {
                        sum += answers[index];
                        count++;
                    }
                });
                
                factor.score = count > 0 ? (sum / count).toFixed(2) : 0;
            });
        }
        
        // 获取因子建议
        function getFactorSuggestion(score, suggestions) {
            if (score >= 3.5) return suggestions.severe;
            if (score >= 2.5) return suggestions.moderate;
            if (score >= 1.5) return suggestions.mild;
            return suggestions.low;
        }
        
        // 显示测试结果
        function showResults() {
            calculateFactorScores();
            
            // 计算总分、阳性项目数和阳性症状均分
            const totalScore = calculateTotalScore();
            const positiveItems = calculatePositiveItems();
            const averageScore = positiveItems > 0 ? (totalScore - (questions.length - positiveItems)) / positiveItems : 0;
            
            // 存储结果
            const results = {
                totalScore,
                positiveItems,
                averageScore,
                factors: factors.map(f => ({name: f.name, score: f.score})),
                answers: [...answers],
                timestamp: new Date().toISOString()
            };
            
            markTestCompleted(testId, results);
            
            // 显示结果
            displayResults(results);
            
            // 更新UI
            testSection.classList.add('hidden');
            testCompleted.classList.remove('hidden');
            resultsDiv.classList.remove('hidden');
            
            // 滚动到结果区域
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // 显示存储的结果
        function displayResults(results) {
            // 更新总分显示
            totalScoreEl.textContent = results.totalScore;
            positiveItemsEl.textContent = results.positiveItems;
            averageScoreEl.textContent = results.averageScore.toFixed(2);
            
            // 生成因子分析
            factorsAnalysisEl.innerHTML = '';
            results.factors.forEach(factor => {
                const factorScore = parseFloat(factor.score);
                const factorEl = document.createElement('div');
                factorEl.className = 'factor';
                
                let severity = '';
                let color = '#2ecc71'; // 绿色，正常
                
                if (factorScore >= 3.5) {
                    severity = ' <span style="color:#e74c3c">(重度)</span>';
                    color = '#e74c3c'; // 红色，重度
                } else if (factorScore >= 2.5) {
                    severity = ' <span style="color:#f39c12">(中度)</span>';
                    color = '#f39c12'; // 橙色，中度
                } else if (factorScore >= 1.5) {
                    severity = ' <span style="color:#3498db">(轻度)</span>';
                    color = '#3498db'; // 蓝色，轻度
                }
                
                // 查找对应的因子建议
                const factorDefinition = factors.find(f => f.name === factor.name);
                let suggestion = '';
                if (factorDefinition) {
                    suggestion = getFactorSuggestion(factorScore, factorDefinition.suggestions);
                }
                
                factorEl.innerHTML = `
                    <div class="factor-header">
                        <span class="factor-name">${factor.name}</span>
                        <span class="factor-score" style="color:${color}">${factor.score}${severity}</span>
                    </div>
                    <div class="factor-description">${factorDefinition.description}</div>
                    <div class="factor-suggestion">
                        <div class="suggestion-title">建议:</div>
                        ${suggestion}
                    </div>
                `;
                
                factorsAnalysisEl.appendChild(factorEl);
            });
            
            // 生成解读和建议
            generateInterpretation(results.totalScore, results.positiveItems, results.averageScore);
        }
        
        // 生成解读和建议
        function generateInterpretation(totalScore, positiveItems, averageScore) {
            let interpretation = "";
            let recommendation = "";
            
            if (totalScore < 150) {
                interpretation = "根据您的测试结果，您当前的心理健康状况总体良好。SCL-90量表的总分和因子分都在正常范围内，表明您近期没有明显的心理症状表现。";
                recommendation = "继续保持健康的生活方式和积极的心态。定期进行自我心理状态评估有助于维持心理健康。可以尝试放松训练或正念冥想来进一步提升心理韧性。";
            } else if (totalScore < 250) {
                interpretation = "测试结果显示您可能存在一些轻度的心理困扰。某些因子分略高于常规水平，表明您近期可能经历了一些压力或情绪波动。";
                recommendation = "建议关注自己的情绪变化，尝试压力管理技巧如深呼吸、冥想或适度运动。如果这些症状持续存在或影响日常生活，可以考虑咨询心理健康专业人士。";
            } else if (totalScore < 350) {
                interpretation = "您的测试结果表明可能存在中度的心理症状。多个因子分超过常规范围，提示您近期可能经历了较大的压力或情绪困扰。";
                recommendation = "建议您重视这些心理信号，考虑寻求专业的心理咨询或治疗。同时，可以尝试建立健康的生活习惯，保证充足睡眠，进行规律运动，并与亲友保持沟通。";
            } else {
                interpretation = "测试结果显示您可能正在经历较为明显的心理困扰。多项因子分显著高于常规水平，表明这些症状可能对您的日常生活造成了一定影响。";
                recommendation = "强烈建议您寻求专业的心理健康服务，如心理咨询师或心理医生的帮助。早期干预通常能带来更好的恢复效果。同时，请确保有良好的社会支持系统，不要独自承受压力。";
            }
            
            interpretationText.textContent = interpretation;
            recommendationText.textContent = recommendation;
        }
        
        // 计算总分
        function calculateTotalScore() {
            return answers.reduce((sum, score) => sum + score, 0);
        }
        
        // 计算阳性项目数
        function calculatePositiveItems() {
            return answers.filter(score => score >= 2).length;
        }
        
        // 初始化页面
        initPage();
    </script>
</body>
</html>